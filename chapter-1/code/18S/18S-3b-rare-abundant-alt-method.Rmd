---
title: "18S-3-rare-abundant"
author: "Amy Solman"
date: "04/08/2021"
output: html_document
---
In this script I'm going to divide my cryoconite data into subcommunities based on their regional abundance.

I will be following the method set out by Gao et al., (2020) and Xue et al., (2018) and Liang et al., (2020)

Step 1: Clear workspace and load packages
Step 2: Load data
Step 3: Divide samples into Arctic and Antarctic
Step 4. Find the relative abundance of each of the ASVs
Step 5: Save the OTUID of those with relative abundance >=1% in all samples into an always abundant (AAT) vector 
Step 6: Save the OTUID of those with relative abundance >=0.01% in all samples and >=1% in some samples into a conditionally abundant (CAT) vector 
Step 7: Save the OTUID of those with relative abundance < 0.01% in all samples into an always rare (ART) vector
Step 8: Save the OTUID of those with relative abundance <0.01% in some samples but never >=1% in any sample into a conditionally rare (CRT) vector
Step 9: Save the OTUID of those with relative abundance between 0.01% and 1% in all samples into a moderate taxa (MT) vector
Step 10: Save the OTUID of those with relative abundance ranging from rare (<0.01%) to abundant (>=1%) in a conditionally rare and abundant taxa (CRAT) vector
Step 11. Filter all samples from each group and only keep the OTUIDs from the AAT vector. This is your AAT dataset.
Step 12. Filter all samples from each group and only keep the OTUIDs from the CAT vector. This is your CAT dataset.
Step 13. Filter all samples from each group and only keep the OTUIDs from the ART vector. This is your ART dataset.
Step 14. Filter all samples from each group and only keep the OTUIDs from the CRT vector. This is your CRT dataset.
Step 15. Filter all samples from each group and only keep the OTUIDs from the MT vector. This is your MT dataset.
Step 16. Filter all samples from each group and only keep the OTUIDs from the CRAT vector. This is your CRAT dataset.
Step 17: Combine the OTUIDs of the AAT and CAT vectors and filter samples by these names. This is your abundant taxa (AT) dataset.
Step 18: Combine the OTUIDs of the ART and CRT vectors and filter samples by these names. This is your rare taxa (RT) dataset.
Step 19. Check our new phyloseq objects, have we captured all of the ASVs?
Step 20. An alternative method for defining abundant, rare and intermediate taxa...
Step 21. Export our new phyloseq objects


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Step One: Clear workspace and load packages
```{r}
rm(list=ls())
graphics.off()

library(phyloseq)
library(dplyr) 
```

#Step Two: Load data 
```{r}
#Load data files
load("../data-output/18S-my-sequence-data.RData") #load all our pre-processed data files

#load phyloseq object
ps <- readRDS("../data-output/18S-my-phyloseq-object.rds") #load unrarefied phyloseq object
ps.rare <- readRDS("../data-output/18S-my-phyloseq-object-rarefied.rds") #load rarefied phyloseq object
```

#Step Three: Divide the rarefied sequences into two new phyloseq objects, one for the Arctic and one for the Antarctic
```{r}
arctic_samples <- subset_samples(ps.rare, Pole=="Arctic")
antarctic_samples <- subset_samples(ps.rare, Pole=="Antarctic")

head(sample_data(arctic_samples))
head(sample_data(antarctic_samples))
```

#Step Four: Find the local relative abundance of each ASV in each sample
```{r}
#get relative abundances
RA_arctic_samples <- transform_sample_counts(arctic_samples, function(x) x/sum(x))
RA_antarctic_samples <- transform_sample_counts(antarctic_samples, function(x) x/sum(x))

#We can check to see if this worked by getting the sum of each of the columns in the count table of the phyloseq object
colSums(otu_table(RA_arctic_samples)) 
colSums(otu_table(RA_antarctic_samples))
#the column sums for the count tables in these phyloseq objects all equal 1 so the columns have the relative abundances

#Remove any ASVs with zero counts across any samples
RA_arctic_samples_filtered <- filter_taxa(RA_arctic_samples, function(x) sum(x) > 0, TRUE)
RA_antarctic_samples_filtered <- filter_taxa(RA_antarctic_samples, function (x) sum(x) > 0, TRUE)
```

#Step Five: Save the OTUID of those with relative abundance >=1% in all samples into an always abundant (AAT) vector 
```{r}
#grab out the count tables from our phyloseq objects
RA_arctic_count_table <- as.data.frame(otu_table(RA_arctic_samples_filtered))
RA_antarctic_count_table <- as.data.frame(otu_table(RA_antarctic_samples_filtered))

#1 = 100%, 0.1 = 10% 0.01 = 1% 0.001 = 0.1% 0.0001 = 0.01% < for reference if we want 1% relative abundance we're looking for a value of 0.01

#We can do it in dplyr 
arctic_AAT <- RA_arctic_count_table %>% filter_all(all_vars(. >= 0.01)) # show me the rows where all values are equal to or greater than 0.01
antarctic_AAT <- RA_antarctic_count_table %>% filter_all(all_vars(. >= 0.01))

# #Or we can do it in base R like this...
# #Here what we're asking is, we are creating a logical matrix by comparing the entire data frame with 0.01 and then do rowSums over it and select only those rows whose value is equal to number of columns in our count table
# arctic_AAT <- RA_arctic_count_table[rowSums(RA_arctic_count_table >= 0.01) == ncol(RA_arctic_count_table), ]
# antarctic_AAT <- RA_antarctic_count_table[rowSums(RA_antarctic_count_table >= 0.01) == ncol(RA_antarctic_count_table), ]
```

#Step Six: Save the OTUID of those with relative abundance >=0.01% in all samples and >=1% in some samples into a conditionally abundant (CAT) vector 
```{r}
#We can do it in dplyr 
arctic_CAT <- RA_arctic_count_table %>% filter_all(all_vars(. >= 0.0001)) # show me the rows where all values are equal to or greater than 0.0001
#Then filter that again to just keep those rows with SOME relative abundances of >=1%
arctic_CAT <- arctic_CAT %>% filter(if_any(.fns = ~. >= 0.01))

antarctic_CAT <- RA_antarctic_count_table %>% filter_all(all_vars(. >= 0.0001))
antarctic_CAT <- antarctic_CAT %>% filter(if_any(.fns = ~. >= 0.01))
```

#Step Seven: Save the OTUID of those with relative abundance < 0.01% in all samples into an always rare (ART) vector
```{r}
arctic_ART <- RA_arctic_count_table %>% filter_all(all_vars(. < 0.0001))
antarctic_ART <- RA_antarctic_count_table %>% filter_all(all_vars(. < 0.0001))
```

#Step Eight: Save the OTUID of those with relative abundance <0.01% in some samples but never >=1% in any sample into a conditionally rare (CRT) vector
```{r}
arctic_CRT <- RA_arctic_count_table %>% filter_all(all_vars(. < 0.01)) #get only the values that are never >=1% (always <1%)
arctic_CRT <- arctic_CRT %>% filter(if_any(.fns = ~. < 0.0001))

antarctic_CRT <- RA_antarctic_count_table %>% filter_all(all_vars(. < 0.01)) #keep only rows with all values less than 0.01
antarctic_CRT <- antarctic_CRT %>% filter(if_any(.fns = ~. < 0.0001)) #keep only rows with some samples <0.001
```

#Step Nine: Save the OTUID of those with relative abundance between 0.01% and 1% in all samples into a moderate taxa (MT) vector
```{r}
arctic_MT <- RA_arctic_count_table %>% filter_all(all_vars(. > 0.0001)) #keep ASVs that are over 0.01% in all samples
arctic_MT <- arctic_MT %>% filter_all(all_vars(. < 0.01)) #keep ASVs that are less than 1% in all samples

antarctic_MT <- RA_antarctic_count_table %>% filter_all(all_vars(. > 0.0001)) #keep ASVs that are over 0.01% in all samples
antarctic_MT <- antarctic_MT %>% filter_all(all_vars(. < 0.01)) #keep ASVs that are less than 1% in all samples
```

#Step 10: Save the OTUID of those with relative abundance ranging from rare (<0.01%) to abundant (>=1%) in a conditionally rare and abundant taxa (CRAT) vector
```{r}
arctic_CRAT <- RA_arctic_count_table %>% filter_all(any_vars(. < 0.0001)) #keep rows where any variables are less than 0.0001 
arctic_CRAT <- arctic_CRAT  %>% filter_all(any_vars(. >= 0.01)) #and more than or equal to 0.01

antarctic_CRAT <- RA_antarctic_count_table %>% filter_all(any_vars(. < 0.0001)) #keep rows where any variables are less than 0.0001 
antarctic_CRAT <- antarctic_CRAT  %>% filter_all(any_vars(. >= 0.01)) #and more than or equal to 0.01
```

#Step 11. Filter all samples from each group and only keep the ASVIDs from the AAT vector. This is your AAT dataset.
```{r}
ASVID_arctic_AAT <- rownames(arctic_AAT) #there are no ASVs here so we'll move on
ASVID_antarctic_AAT <- rownames(antarctic_AAT)

# HAVE HASHED OUT THE BELOW CODE BECAUSE THERE ARE NO ASVS THAT MEET THESE CONDITIONS

# #Now subset the phyloseq object by those IDs
# arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_AAT)
# antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_AAT)
# 
# #Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
# ps.rare.arctic.AAT <- merge_phyloseq(arctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
# ps.rare.antarctic.AAT <- merge_phyloseq(antarctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
```

#Step 12. Filter all samples from each group and only keep the ASVIDs from the CAT vector. This is your CAT dataset.
```{r}
ASVID_arctic_CAT <- rownames(arctic_CAT)
ASVID_antarctic_CAT <- rownames(antarctic_CAT)

# HAVE HASHED OUT THE BELOW CODE BECAUSE THERE ARE NO ASVS THAT MEET THESE CONDITIONS

# #Now subset the phyloseq object by those IDs
# arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_CAT)
# antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_CAT)
# 
# #Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
# ps.rare.arctic.CAT <- merge_phyloseq(arctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
# ps.rare.antarctic.CAT <- merge_phyloseq(antarctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
```

#Step 13. Filter all samples from each group and only keep the ASVIDs from the ART vector. This is your ART dataset.
```{r}
ASVID_arctic_ART <- rownames(arctic_ART) #get our ASV IDS
ASVID_antarctic_ART <- rownames(antarctic_ART)

#Now subset the phyloseq object by those IDs
arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_ART)
antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_ART)

#Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
ps.rare.arctic.ART <- merge_phyloseq(arctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
ps.rare.antarctic.ART <- merge_phyloseq(antarctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
```

#Step 14. Filter all samples from each group and only keep the OTUIDs from the CRT vector. This is your CRT dataset.
```{r}
ASVID_arctic_CRT <- rownames(arctic_CRT) #get our ASV IDS
ASVID_antarctic_CRT <- rownames(antarctic_CRT)

#Now subset the phyloseq object by those IDs
arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_CRT)
antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_CRT)

#Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
ps.rare.arctic.CRT <- merge_phyloseq(arctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
ps.rare.antarctic.CRT <- merge_phyloseq(antarctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
```

#Step 15. Filter all samples from each group and only keep the OTUIDs from the MT vector. This is your MT dataset.
```{r}
ASVID_arctic_MT <- rownames(arctic_MT) #get our ASV IDS
ASVID_antarctic_MT <- rownames(antarctic_MT)

# HAVE HASHED OUT THE BELOW CODE BECAUSE THERE ARE NO ASVS THAT MEET THESE CONDITIONS

# #Now subset the phyloseq object by those IDs
# arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_MT)
# antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_MT)
# 
# #Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
# ps.rare.arctic.MT <- merge_phyloseq(arctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
# ps.rare.antarctic.MT <- merge_phyloseq(antarctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
```

#Step 16. Filter all samples from each group and only keep the OTUIDs from the CRAT vector. This is your CRAT dataset.
```{r}
ASVID_arctic_CRAT <- rownames(arctic_CRAT) #get our ASV IDS
ASVID_antarctic_CRAT <- rownames(antarctic_CRAT)

#Now subset the phyloseq object by those IDs
arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_CRAT)
antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_CRAT)

#Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
ps.rare.arctic.CRAT <- merge_phyloseq(arctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
ps.rare.antarctic.CRAT <- merge_phyloseq(antarctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
```

#Step 17: Combine the OTUIDs of the AAT and CAT vectors and filter samples by these names. This is your abundant taxa (AT) dataset.
```{r}
ASVID_arctic_AAT_CAT <- c(ASVID_arctic_AAT, ASVID_arctic_CAT)#get our ASV IDS
ASVID_antarctic_AAT_CAT <- c(ASVID_antarctic_AAT, ASVID_antarctic_CAT)#get our ASV IDS

# HAVE HASHED OUT THE BELOW CODE BECAUSE THERE ARE NO ASVS THAT MEET THESE CONDITIONS

# #Now subset the phyloseq object by those IDs
# arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_AAT_CAT)
# antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_AAT_CAT)
# 
# #Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
# ps.rare.arctic.AT <- merge_phyloseq(arctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
# ps.rare.antarctic.AT <- merge_phyloseq(antarctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
```

#Step 18: Combine the OTUIDs of the ART and CRT vectors and filter samples by these names. This is your rare taxa (RT) dataset.
```{r}
ASVID_arctic_ART_CRT <- c(ASVID_arctic_ART, ASVID_arctic_CRT)#get our ASV IDS
ASVID_antarctic_ART_CRT <- c(ASVID_antarctic_ART, ASVID_antarctic_CRT)#get our ASV IDS

#Now subset the phyloseq object by those IDs
arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_ART_CRT)
antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_ART_CRT)

#Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
ps.rare.arctic.RT <- merge_phyloseq(arctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
ps.rare.antarctic.RT <- merge_phyloseq(antarctic_my_subset, tax_table(ps.rare), sample_data(ps.rare), phy_tree(ps.rare))
```

#Step 19. Check our new phyloseq objects, have we captured all of the ASVs?
```{r}
#How many ASVs were in our filtered, pole-specific, relative abundance + rarefied phyloseq objects?
RA_arctic_samples_filtered #2224 taxa
RA_antarctic_samples_filtered #5505 taxa

#How many ASVs are in our AT and RT phyloseq objects?
#ps.rare.arctic.AT #doesn't exist
#ps.rare.antarctic.AT #doesn't exist
ps.rare.arctic.RT #1915 taxa
ps.rare.antarctic.RT #4913 taxa

#How many ASVs are in our MT and CRAT phyloseq objects?
#ps.rare.arctic.MT #doesn't exist
#ps.rare.antarctic.MT #doesn't exist
ps.rare.arctic.CRAT #309
ps.rare.antarctic.CRAT #592

#Arctic
#1915+309 = 2224

#Antarctic
#4913 + 592 = 5505

#So all of our ASVs are either rare taxa or conditionally rare and abundant

```

#Step 20. An alternative method for defining abundant, rare and intermediate taxa...
From the above outcome we can see than none of our taxa meet the criteria of abundant or moderate. Let's try a different method.
Following Liu et al. (2015), Li et al., (2021)
Step 1: Divide samples into Arctic and Antarctic
Step 2. Find the relative abundance of each of the ASVs
Step 3: Find the mean local relative abundance of each ASV within the Arctic and Antarctic groups
Step 4. Save the OTUID of those with mean relative abundance >0.1% (or >=0.1%) into a regionally abundant vector
Step 5. Save the OTUID of those with mean relative abundance <0.001% (or <=0.05% or <0.01% ) into a regionally rare vector
Step 6. Save the OTUID of those with mean relative abundance >=0.001% and =<0.1% (or >0.05% and <0.1% or >=0.01% and <=0.01%) into a regionally intermediate vector
Step 7. Filter all samples from each group and only keep the OTUIDs from the abundant vector. This is your abundant dataset.
Step 8. Filter all samples from each group and only keep the OTUIDs from the rare vector. This is your rare dataset.
Step 9. Filter all samples from each group and only keep the OTUIDs from the intermediate vector. This is your intermediate dataset.
```{r}
#Step 3: Find the mean local relative abundance of each ASV within the Arctic and Antarctic groups
mean_RA_arctic <- as.data.frame(rowMeans(otu_table(RA_arctic_samples_filtered)))
mean_RA_antarctic <- as.data.frame(rowMeans(otu_table(RA_antarctic_samples_filtered)))


#Step 4: Save the OTUID of those with mean relative abundance >0.1% (or >=0.1%) into a regionally abundant vector

#keep only the ASVs with relative abundance >=0.1%
RA_arctic <- mean_RA_arctic %>% filter(apply(., 1, function(x) any(x >= 0.001)))
RA_antarctic <- mean_RA_antarctic %>% filter(apply(., 1, function(x) any(x >= 0.001)))

#Step 5: Save the OTUID of those with mean relative abundance <0.001% (or <=0.05% or <0.01% ) into a regionally rare vector

#keep only the ASVs with relative abundance <=0.001%
RR_arctic <- mean_RA_arctic %>% filter(apply(., 1, function(x) any(x <= 0.00001)))
RR_antarctic <- mean_RA_antarctic %>% filter(apply(., 1, function(x) any(x <= 0.00001)))

#Step 6. Save the OTUID of those with mean relative abundance >=0.001% and =<0.1% (or >0.05% and <0.1% or >=0.01% and <=0.01%) into a regionally intermediate vector

I_arctic <- mean_RA_arctic %>% filter(apply(., 1, function(x) any(x > 0.00001 & x < 0.001)))
I_antarctic <- mean_RA_antarctic %>% filter(apply(., 1, function(x) any(x >0.00001 & x < 0.001)))

#Let's double check how many ASVs we have now
nrow(RA_arctic) #210
nrow(RR_arctic) #128
nrow(I_arctic) #1886
#210+128+1886 = 2224 taxa

nrow(RA_antarctic) #196
nrow(RR_antarctic) #1322
nrow(I_antarctic) #3987
#196+1322+3987 = 5505

#PERFECT! All our ASVs are classified as either rare, abundant or intermediate 

#Step 7. Filter all samples from each group and only keep the OTUIDs from the abundant vector. This is your abundant dataset.
ASVID_arctic_RA <- rownames(RA_arctic) #get our ASV IDS
ASVID_antarctic_RA <- rownames(RA_antarctic)

#Now subset the phyloseq object by those IDs
arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_RA)
antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_RA)

#Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
ps.rare.arctic.RA <- merge_phyloseq(arctic_my_subset, tax_table(arctic_samples), sample_data(arctic_samples), phy_tree(arctic_samples))
ps.rare.antarctic.RA <- merge_phyloseq(antarctic_my_subset, tax_table(antarctic_samples), sample_data(antarctic_samples), phy_tree(antarctic_samples))

#Step 8. Filter all samples from each group and only keep the OTUIDs from the rare vector. This is your rare dataset.
ASVID_arctic_RR <- rownames(RR_arctic) #get our ASV IDS
ASVID_antarctic_RR <- rownames(RR_antarctic)

#Now subset the phyloseq object by those IDs
arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_RR)
antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_RR)

#Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
ps.rare.arctic.RR <- merge_phyloseq(arctic_my_subset, tax_table(arctic_samples), sample_data(arctic_samples), phy_tree(arctic_samples))
ps.rare.antarctic.RR <- merge_phyloseq(antarctic_my_subset, tax_table(antarctic_samples), sample_data(antarctic_samples), phy_tree(antarctic_samples))

#Step 9. Filter all samples from each group and only keep the OTUIDs from the intermediate vector. This is your intermediate dataset.
ASVID_arctic_I <- rownames(I_arctic) #get our ASV IDS
ASVID_antarctic_I <- rownames(I_antarctic)

#Now subset the phyloseq object by those IDs
arctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_arctic_I)
antarctic_my_subset <- subset(otu_table(ps.rare), rownames(otu_table(ps.rare)) %in% ASVID_antarctic_I)

#Next merge the subset with the rest of the taxonomic, metadata and phylogenetic tree info to build a new phyloseq object
ps.rare.arctic.I <- merge_phyloseq(arctic_my_subset, tax_table(arctic_samples), sample_data(arctic_samples), phy_tree(arctic_samples))
ps.rare.antarctic.I <- merge_phyloseq(antarctic_my_subset, tax_table(antarctic_samples), sample_data(antarctic_samples), phy_tree(antarctic_samples))
```

#Step 21: Export phyloseq objects
```{r}
#Now I'm going to export my phyloseq object
saveRDS(arctic_samples, "../data-output/18S-arctic-rarefied.rds")
saveRDS(ps.rare.arctic.RA, "../data-output/18S-arctic-rarefied-abundant.rds")
saveRDS(ps.rare.arctic.RR, "../data-output/18S-arctic-rarefied-rare.rds")
saveRDS(ps.rare.arctic.I, "../data-output/18S-arctic-rarefied-intermediate.rds")
saveRDS(antarctic_samples, "../data-output/18S-antarctic-rarefied.rds")
saveRDS(ps.rare.antarctic.RA, "../data-output/18S-antarctic-rarefied-abundant.rds")
saveRDS(ps.rare.antarctic.RR, "../data-output/18S-antarctic-rarefied-rare.rds")
saveRDS(ps.rare.antarctic.I, "../data-output/18S-antarctic-rarefied-intermediate.rds")
```
